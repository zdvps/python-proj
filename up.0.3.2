#!/usr/bin/env bash
#----------------------
# ---- Autor: Zenio zndv@outlook.com 21977036020
# ---- última atualização: 12/10/2025

set -euo pipefail

info() {
  echo -e "\033[1;32m[INFO]\033[0m $1"
}
warn() {
  echo -e "\033[1;33m[AVISO]\033[0m $1"
}
error() {
  echo -e "\033[1;31m[ERRO]\033[0m $1"
}

if [[ "$(id -u)" -ne 0 ]]; then
    error "Este script deve ser executado como root. Use: sudo $0"
    exit 1
fi

trap 'error "Ocorreu um erro na linha $LINENO. Abortando."' ERR

info "Você está logado como root. Iniciando manutenção..."

info "Corrigindo pacotes quebrados..."
dpkg --configure -a
apt --fix-broken install -y

info "Atualizando a lista de pacotes..."
apt update

info "Realizando upgrade completo..."
apt full-upgrade -y

# Atualização snap se snap estiver instalado
if command -v snap &>/dev/null; then
    info "Atualizando pacotes snap..."
    snap refresh || warn "Falha ao atualizar snaps."
fi

info "Removendo pacotes desnecessários..."
apt autoremove -y

info "Limpando pacotes residuais..."
apt autoclean
apt clean

info "Ubuntu atualizado, limpo e seguro!"

